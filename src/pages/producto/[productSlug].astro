---
import BaseLayout from "@/layouts/BaseLayout.astro";
import { createClient } from "@/lib/supabase";
import { getProductFullDetailsBySlug } from "@/lib/data/products";
import { AddToCartButton } from "@/components/AddToCartButton/AddToCartButton";

const { productSlug } = Astro.params;
console.log(productSlug);

if (!productSlug) {
  return Astro.redirect("/categorias");
}

const supabase = createClient({
  request: Astro.request,
  cookies: Astro.cookies,
});

const productDetails = await getProductFullDetailsBySlug(supabase, productSlug);

if (!productDetails) {
  return Astro.redirect("/404");
}

const { product, category, subcategory, assets } = productDetails;

// Helper para obtener URL pública de Supabase Storage
const getPublicUrl = (bucket: string, path: string) => {
  const { data } = supabase.storage.from(bucket).getPublicUrl(path);
  return data.publicUrl;
};

// Preparar assets con URLs públicas
const galleryAssets = assets.gallery.map(asset => ({
  ...asset,
  url: getPublicUrl(asset.storage_bucket, asset.storage_path),
  posterUrl: asset.poster_storage_path ? getPublicUrl(asset.storage_bucket, asset.poster_storage_path) : null,
}));

const additionalAssets = assets.additional.map(asset => ({
  ...asset,
  url: getPublicUrl(asset.storage_bucket, asset.storage_path),
}));

const downloadAssets = assets.download.map(asset => ({
  ...asset,
  url: getPublicUrl(asset.storage_bucket, asset.storage_path),
}));

// Obtener imagen principal para fallback
const primaryImage = galleryAssets.find(a => a.is_primary) || galleryAssets[0];

// Información del producto
const brand = product.brand || product.attributes.brand || 'ARM';
const material = product.attributes.material || 'Madera';

// Meta tags
const pageTitle = `${product.name} | ARM`;
const pageDescription = product.description || `${product.name} - ${subcategory.name}`;

// Helper para formatear tipos de archivo (MIME types largos a extensiones legibles)
const getFileTypeLabel = (mimeType: string | null, filename: string | null): string => {
  // Primero intentar obtener la extensión del filename
  if (filename) {
    const ext = filename.split('.').pop()?.toUpperCase();
    if (ext && ext.length <= 5) return ext;
  }
  
  if (!mimeType) return 'ARCHIVO';
  
  // Mapeo de MIME types comunes a extensiones legibles
  const mimeMap: Record<string, string> = {
    'application/pdf': 'PDF',
    'application/vnd.openxmlformats-officedocument.spreadsheetml.sheet': 'XLSX',
    'application/vnd.ms-excel': 'XLS',
    'application/vnd.openxmlformats-officedocument.wordprocessingml.document': 'DOCX',
    'application/msword': 'DOC',
    'application/vnd.openxmlformats-officedocument.presentationml.presentation': 'PPTX',
    'application/vnd.ms-powerpoint': 'PPT',
    'application/zip': 'ZIP',
    'application/x-rar-compressed': 'RAR',
    'application/x-7z-compressed': '7Z',
    'text/plain': 'TXT',
    'text/csv': 'CSV',
    'image/jpeg': 'JPG',
    'image/png': 'PNG',
    'image/gif': 'GIF',
    'image/webp': 'WEBP',
  };
  
  const lowerMime = mimeType.toLowerCase();
  if (mimeMap[lowerMime]) return mimeMap[lowerMime];
  
  // Si no está en el mapa, intentar extraer la extensión del MIME type
  const parts = mimeType.split('/');
  if (parts.length === 2) {
    const subtype = parts[1].toUpperCase();
    // Si es muy largo, truncar
    if (subtype.length > 6) {
      return subtype.substring(0, 4);
    }
    return subtype;
  }
  
  return 'ARCHIVO';
};

// Helper para formatear tamaño de archivo
const formatFileSize = (bytes: number | null): string => {
  if (!bytes) return '';
  if (bytes < 1024) return `${bytes} B`;
  if (bytes < 1024 * 1024) return `${(bytes / 1024).toFixed(1)} KB`;
  return `${(bytes / (1024 * 1024)).toFixed(2)} MB`;
};
---

<BaseLayout title={pageTitle} description={pageDescription}>
  <div class="product-page">
    <!-- Breadcrumb -->
    <div class="breadcrumb-container">
      <nav class="breadcrumb">
        <a href="/">Inicio</a>
        <span class="separator">/</span>
        <a href="/categorias">Categorías</a>
        <span class="separator">/</span>
        <a href={`/categorias/${category.slug}`}>{category.name}</a>
        <span class="separator">/</span>
        <span class="current">{product.name}</span>
      </nav>
    </div>

    <!-- Product Main Section -->
    <section class="product-main">
      <!-- Gallery Section -->
      <div class="gallery-section">
        {galleryAssets.length > 1 && (
          <div class="gallery-thumbnails">
            {galleryAssets.map((asset, index) => (
              <button
                class={`thumbnail ${index === 0 ? "active" : ""}`}
                data-index={index}
                aria-label={`Ver ${asset.kind === 'video' ? 'video' : 'imagen'} ${index + 1}`}
              >
                {asset.kind === "image" ? (
                  <img
                    src={asset.url}
                    alt={asset.alt || `${product.name} - Vista ${index + 1}`}
                    loading="lazy"
                  />
                ) : (
                  <div class="video-thumbnail">
                    <svg
                      width="24"
                      height="24"
                      viewBox="0 0 24 24"
                      fill="none"
                      stroke="currentColor"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <polygon points="5 3 19 12 5 21 5 3" />
                    </svg>
                  </div>
                )}
              </button>
            ))}
          </div>
        )}

        <div class="gallery-main" style={galleryAssets.length === 1 ? 'grid-column: 1 / -1;' : ''}>
          {galleryAssets.length > 0 ? (
            galleryAssets.map((asset, index) => (
              <div
                class={`media-item ${index === 0 ? "active" : ""}`}
                data-index={index}
              >
                {asset.kind === "image" ? (
                  <img 
                    src={asset.url} 
                    alt={asset.alt || product.name}
                    loading={index === 0 ? "eager" : "lazy"}
                  />
                ) : (
                  <video 
                    controls 
                    preload="metadata"
                    poster={asset.posterUrl || undefined}
                  >
                    <source src={asset.url} type={asset.mime_type || "video/mp4"} />
                    Tu navegador no soporta el elemento de video.
                  </video>
                )}
              </div>
            ))
          ) : (
            <div class="media-item active">
              <div class="no-image">
                <svg width="80" height="80" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1">
                  <rect x="3" y="3" width="18" height="18" rx="2" ry="2"></rect>
                  <circle cx="8.5" cy="8.5" r="1.5"></circle>
                  <polyline points="21 15 16 10 5 21"></polyline>
                </svg>
                <p>Sin imagen disponible</p>
              </div>
            </div>
          )}

          <!-- Badges -->
          {new Date(product.created_at).getTime() > Date.now() - 30 * 24 * 60 * 60 * 1000 && (
            <div class="product-badges">
              <span class="badge badge-new">NOVEDAD</span>
            </div>
          )}
        </div>
      </div>

      <!-- Product Info Section -->
      <div class="product-info">
        <h1 class="product-title">{product.name}</h1>
        <p class="product-subtitle">{subcategory.name}</p>

        <!-- Product Meta -->
        <div class="product-meta">
          <div class="meta-item">
            <span class="meta-label">Marca:</span>
            <span class="meta-value">{brand}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Material:</span>
            <span class="meta-value">{material}</span>
          </div>
          <div class="meta-item">
            <span class="meta-label">Categoría:</span>
            <span class="meta-value">{category.name}</span>
          </div>
        </div>

        <!-- Add to Cart -->
        <div class="add-to-cart-section">
          <div class="quantity-selector">
            <button
              class="quantity-btn"
              id="decreaseQty"
              aria-label="Disminuir cantidad"
            >
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                aria-hidden="true"
              >
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </button>
            <input
              type="number"
              id="quantity"
              value="1"
              min="1"
              max="99"
              aria-label="Cantidad"
            />
            <button
              class="quantity-btn"
              id="increaseQty"
              aria-label="Aumentar cantidad"
            >
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                aria-hidden="true"
              >
                <line x1="12" y1="5" x2="12" y2="19"></line>
                <line x1="5" y1="12" x2="19" y2="12"></line>
              </svg>
            </button>
          </div>

          <AddToCartButton
            product={{
              ...product,
              quantity: 1,
            } as import("@/lib/data/types").CartItem}
            client:load
          />
        </div>

        <!-- Quick Actions Links -->
        <div class="quick-links">
          <a href="#detalles" class="quick-link">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              aria-hidden="true"
            >
              <path d="M12 2v20M2 12h20"></path>
            </svg>
            Detalles del producto
          </a>
          {additionalAssets.length > 0 && (
            <a href="#ejemplos" class="quick-link">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                aria-hidden="true"
              >
                <rect x="2" y="2" width="20" height="20" rx="2.18" ry="2.18"></rect>
                <line x1="7" y1="2" x2="7" y2="22"></line>
                <line x1="17" y1="2" x2="17" y2="22"></line>
                <line x1="2" y1="12" x2="22" y2="12"></line>
              </svg>
              Ver más imágenes
            </a>
          )}
          {downloadAssets.length > 0 && (
            <a href="#descargas" class="quick-link">
              <svg
                width="16"
                height="16"
                viewBox="0 0 24 24"
                fill="none"
                stroke="currentColor"
                stroke-width="2"
                aria-hidden="true"
              >
                <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                <polyline points="7 10 12 15 17 10"></polyline>
                <line x1="12" y1="15" x2="12" y2="3"></line>
              </svg>
              Archivos descargables
            </a>
          )}
          <a href="#confianza" class="quick-link">
            <svg
              width="16"
              height="16"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="2"
              aria-hidden="true"
            >
              <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z"></path>
            </svg>
            Madera ecológica, fabricación local
          </a>
        </div>
      </div>
    </section>

    <!-- Product Details Section -->
    <!-- Product Details Section - Two Column Layout -->
    <section id="detalles" class="details-section">
      <div class="details-grid">
        <!-- Left Column: Description + Accordions -->
        <div class="details-left">
          <h2 class="details-title">Detalles del producto</h2>
          {product.description && (
            <p class="details-description">{product.description}</p>
          )}

          <!-- Accordions -->
          <div class="accordions-container">
            <!-- Características - Abierto por defecto -->
            <details class="accordion" open>
              <summary class="accordion-header">
                <span>Características</span>
                <svg class="accordion-icon" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <line x1="12" y1="5" x2="12" y2="19"></line>
                  <line x1="5" y1="12" x2="19" y2="12"></line>
                </svg>
              </summary>
              <div class="accordion-content">
                <!-- Nuestra Madera -->
                <div class="info-block">
                  <h4 class="info-block-title">Nuestra madera</h4>
                  <p class="info-block-text">
                    Este es un mueble sostenible y reciclable con certificación PEFC. 
                    Fabricado con madera maciza ecológica de pino insignis, procedente de bosques locales y sostenibles.
                  </p>
                </div>

                <!-- Material -->
                {material && (
                  <div class="characteristic-item">
                    <span class="characteristic-label">Material</span>
                    <span class="characteristic-value">{material}</span>
                  </div>
                )}

                <!-- Marca -->
                {brand && (
                  <div class="characteristic-item">
                    <span class="characteristic-label">Marca</span>
                    <span class="characteristic-value">{brand}</span>
                  </div>
                )}

                <!-- Acabado -->
                {product.attributes.acabado && (
                  <div class="characteristic-item">
                    <span class="characteristic-label">Acabado</span>
                    <span class="characteristic-value">{product.attributes.acabado}</span>
                  </div>
                )}

                <!-- Montaje -->
                {product.attributes.montaje && (
                  <div class="characteristic-item">
                    <span class="characteristic-label">Montaje</span>
                    <span class="characteristic-value">{product.attributes.montaje}</span>
                  </div>
                )}

                <!-- Envío -->
                {product.attributes.envio && (
                  <div class="characteristic-item">
                    <span class="characteristic-label">Envío</span>
                    <span class="characteristic-value">{product.attributes.envio}</span>
                  </div>
                )}

                <!-- Embalaje -->
                {product.attributes.embalaje && (
                  <div class="characteristic-item">
                    <span class="characteristic-label">Embalaje</span>
                    <span class="characteristic-value">{product.attributes.embalaje}</span>
                  </div>
                )}

                <!-- Todas las características dinámicas restantes -->
                {Object.entries(product.attributes)
                  .filter(([key]) => 
                    !['medida', 'dimensi', 'altura', 'ancho', 'largo', 'profund', 'fondo', 'longitud', 'alto', 'acabado', 'montaje', 'envio', 'embalaje', 'material', 'brand', 'sku', 'price_note'].some(term => key.toLowerCase().includes(term))
                  )
                  .map(([key, value]) => (
                    <div class="characteristic-item">
                      <span class="characteristic-label">{key.replace(/_/g, ' ').replace(/^\w/, c => c.toUpperCase())}</span>
                      <span class="characteristic-value">{typeof value === 'object' ? JSON.stringify(value) : value}</span>
                    </div>
                  ))}
              </div>
            </details>
          </div>
        </div>

        <!-- Right Column: Measurements -->
        <div class="details-right">
          <h2 class="measurements-title">Medidas</h2>
          
          {/* Verificar si hay alguna medida disponible */}
          {(product.attributes.altura || product.attributes.alto || 
            product.attributes.longitud || product.attributes.largo || product.attributes.ancho ||
            product.attributes.fondo || product.attributes.profundidad ||
            product.attributes.dimensiones ||
            Object.keys(product.attributes).some(k => k.toLowerCase().includes('medida') || k.toLowerCase().includes('dimensi'))) ? (
            <div class="measurements-grid">
              <!-- Altura -->
              {(product.attributes.altura || product.attributes.alto) && (
                <div class="measurement-card">
                  <h4 class="measurement-label">Altura</h4>
                  <p class="measurement-value">
                    {product.attributes.altura || product.attributes.alto}
                  </p>
                </div>
              )}

              <!-- Longitud -->
              {(product.attributes.longitud || product.attributes.largo || product.attributes.ancho) && (
                <div class="measurement-card">
                  <h4 class="measurement-label">Longitud</h4>
                  <p class="measurement-value">
                    {product.attributes.longitud || product.attributes.largo || product.attributes.ancho}
                  </p>
                </div>
              )}

              <!-- Fondo / Profundidad -->
              {(product.attributes.fondo || product.attributes.profundidad) && (
                <div class="measurement-card">
                  <h4 class="measurement-label">Fondo</h4>
                  <p class="measurement-value">
                    {product.attributes.fondo || product.attributes.profundidad}
                  </p>
                </div>
              )}

              <!-- Dimensiones generales -->
              {product.attributes.dimensiones && (
                <div class="measurement-card full-width">
                  <h4 class="measurement-label">Dimensiones</h4>
                  <p class="measurement-value">
                    {product.attributes.dimensiones}
                  </p>
                </div>
              )}

              <!-- Otras medidas dinámicas -->
              {Object.entries(product.attributes)
                .filter(([key]) => 
                  (key.toLowerCase().includes('medida') || 
                  key.toLowerCase().includes('dimensi')) &&
                  !['dimensiones'].includes(key.toLowerCase())
                )
                .map(([key, value]) => (
                  <div class="measurement-card">
                    <h4 class="measurement-label">{key.replace(/_/g, ' ').replace(/^\w/, c => c.toUpperCase())}</h4>
                    <p class="measurement-value">{value}</p>
                  </div>
                ))}
            </div>
          ) : (
            <!-- Estado sin medidas especificadas -->
            <div class="no-measurements">
              <svg class="no-measurements-icon" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                <path d="M21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73l7 4a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16z"></path>
              </svg>
              <span class="no-measurements-text">Medidas no especificadas. Consulta la ficha técnica para más detalles.</span>
            </div>
          )}

          <!-- Nota informativa sobre ficha técnica -->
          {downloadAssets.length > 0 && (
            <div class="tech-sheet-note">
              <div class="tech-sheet-icon">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <circle cx="12" cy="12" r="10"></circle>
                  <line x1="12" y1="16" x2="12" y2="12"></line>
                  <line x1="12" y1="8" x2="12.01" y2="8"></line>
                </svg>
              </div>
              <div class="tech-sheet-content">
                <p class="tech-sheet-text">
                  ¿Necesitas información más detallada? Descarga la <strong>ficha técnica</strong> del producto con todas las especificaciones completas.
                </p>
                <a href="#descargas" class="tech-sheet-link">
                  <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                    <polyline points="7 10 12 15 17 10"></polyline>
                    <line x1="12" y1="15" x2="12" y2="3"></line>
                  </svg>
                  Ver archivos descargables
                </a>
              </div>
            </div>
          )}
        </div>
      </div>
    </section>

    <!-- Examples Section -->
    {additionalAssets.length > 0 && (
      <section id="ejemplos" class="examples-section">
        <h2>Galería adicional</h2>
        <p class="section-subtitle">
          Más imágenes y videos del producto
        </p>

        <div class="examples-grid">
          {additionalAssets.map((asset, index) => (
            <div class={`example-item ${index === 0 && additionalAssets.length > 2 ? 'large' : ''}`}>
              {asset.kind === "image" ? (
                <img
                  src={asset.url}
                  alt={asset.alt || `${product.name} - ${asset.title || 'Imagen adicional'}`}
                  loading="lazy"
                />
              ) : (
                <div class="example-item video-item">
                  <video
                    controls
                    preload="metadata"
                  >
                    <source src={asset.url} type={asset.mime_type || "video/mp4"} />
                  </video>
                  <div class="video-overlay">
                    <svg
                      width="64"
                      height="64"
                      viewBox="0 0 24 24"
                      fill="white"
                      stroke="white"
                      stroke-width="2"
                      aria-hidden="true"
                    >
                      <polygon points="5 3 19 12 5 21 5 3"></polygon>
                    </svg>
                  </div>
                </div>
              )}
            </div>
          ))}
        </div>
      </section>
    )}

    <!-- Downloads Section -->
    {downloadAssets.length > 0 && (
      <section id="descargas" class="downloads-section">
        <h2>Archivos descargables</h2>
        <p class="section-subtitle">Manuales, certificados y documentación</p>

        <div class="downloads-grid">
          {downloadAssets.map((file) => (
            <button 
              type="button"
              class="download-card" 
              data-url={file.url}
              data-filename={file.filename || 'archivo'}
              aria-label={`Descargar ${file.title || file.filename}`}
            >
              <div class="download-icon">
                <svg
                  width="32"
                  height="32"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  aria-hidden="true"
                >
                  <path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z" />
                  <polyline points="14 2 14 8 20 8" />
                  <line x1="12" y1="18" x2="12" y2="12" />
                  <polyline points="9 15 12 18 15 15" />
                </svg>
              </div>
              <div class="download-info">
                <h3>{file.title || file.filename}</h3>
                <div class="download-meta">
                  <span class="file-type">{getFileTypeLabel(file.mime_type, file.filename)}</span>
                  {file.file_size_bytes && (
                    <span class="file-size">{formatFileSize(file.file_size_bytes)}</span>
                  )}
                </div>
              </div>
              <div class="download-action">
                <svg
                  width="20"
                  height="20"
                  viewBox="0 0 24 24"
                  fill="none"
                  stroke="currentColor"
                  stroke-width="2"
                  aria-hidden="true"
                >
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4" />
                  <polyline points="7 10 12 15 17 10" />
                  <line x1="12" y1="15" x2="12" y2="3" />
                </svg>
              </div>
            </button>
          ))}
        </div>
      </section>
    )}

    <!-- Trust Section -->
    <section id="confianza" class="trust-section">
      <div class="trust-header">
        <h2>Madera ecológica, fabricación local</h2>
      </div>

      <div class="trust-grid-horizontal">
        <div class="trust-card-horizontal">
          <div class="trust-icon-horizontal">
            <svg
              width="64"
              height="64"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
            >
              <circle cx="12" cy="8" r="7"></circle>
              <polyline points="8.21 13.89 7 23 12 20 17 23 15.79 13.88"
              ></polyline>
            </svg>
          </div>
          <div class="trust-content">
            <h3>Certificado PEFC</h3>
            <p>
              Fabricamos nuestros muebles con madera sostenible con certificado
              PEFC.
            </p>
          </div>
        </div>

        <div class="trust-card-horizontal">
          <div class="trust-icon-horizontal">
            <svg
              width="64"
              height="64"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
            >
              <circle cx="12" cy="12" r="10"></circle>
              <circle cx="12" cy="12" r="6"></circle>
              <circle cx="12" cy="12" r="2"></circle>
            </svg>
          </div>
          <div class="trust-content">
            <h3>Madera de verdad</h3>
            <p>
              Nuestros muebles tienen nudos y vetas porque son de madera de
              verdad. Madera que nos apasiona.
            </p>
          </div>
        </div>

        <div class="trust-card-horizontal">
          <div class="trust-icon-horizontal">
            <svg
              width="64"
              height="64"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
            >
              <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"></path>
              <circle cx="12" cy="10" r="3"></circle>
            </svg>
          </div>
          <div class="trust-content">
            <h3>Made in Gipuzkoa</h3>
            <p>
              Producción local en nuestra fábrica de Aizarnazabal, Gipuzkoa.
            </p>
          </div>
        </div>

        <div class="trust-card-horizontal">
          <div class="trust-icon-horizontal">
            <svg
              width="64"
              height="64"
              viewBox="0 0 24 24"
              fill="none"
              stroke="currentColor"
              stroke-width="1.5"
            >
              <line x1="18" y1="20" x2="18" y2="10"></line>
              <line x1="12" y1="20" x2="12" y2="4"></line>
              <line x1="6" y1="20" x2="6" y2="14"></line>
            </svg>
          </div>
          <div class="trust-content">
            <h3>Creemos en la proximidad</h3>
            <p>
              Creemos en la proximidad. Nuestro proveedor de colchones está a 8
              kms de nuestra fábrica.
            </p>
          </div>
        </div>
      </div>
    </section>
  </div>
</BaseLayout>

<style>
  .product-page {
    max-width: 1400px;
    margin: 0 auto;
    padding: 0 1.5rem;
  }

  /* Breadcrumb */
  .breadcrumb-container {
    padding: 1.5rem 0;
    border-bottom: 1px solid #e5e7eb;
    margin-bottom: 2rem;
  }

  .breadcrumb {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.875rem;
    flex-wrap: wrap;
  }

  .breadcrumb a {
    color: #6b7280;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .breadcrumb a:hover {
    color: #111827;
  }

  .breadcrumb .separator {
    color: #d1d5db;
  }

  .breadcrumb .current {
    color: #111827;
    font-weight: 500;
  }

  /* Product Main Section */
  .product-main {
    display: grid;
    grid-template-columns: 1fr 480px;
    gap: 4rem;
    margin-bottom: 4rem;
  }

  /* Gallery */
  .gallery-section {
    display: grid;
    grid-template-columns: 100px 1fr;
    gap: 1rem;
  }

  .gallery-thumbnails {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
  }

  .thumbnail {
    aspect-ratio: 1;
    border: 2px solid transparent;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
    background: #f9fafb;
    transition: all 0.2s ease;
    padding: 0;
  }

  .thumbnail:hover {
    border-color: #d1d5db;
  }

  .thumbnail.active {
    border-color: #111827;
  }

  .thumbnail img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .video-thumbnail {
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #1f2937;
    color: white;
  }

  .gallery-main {
    position: relative;
    background: #f9fafb;
    border-radius: 12px;
    overflow: hidden;
    width: 100%;
    height: 600px;
  }

  .media-item {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    opacity: 0;
    transition: opacity 0.4s ease-in-out;
    pointer-events: none;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .media-item.active {
    opacity: 1;
    pointer-events: auto;
    z-index: 1;
  }

  .media-item img,
  .media-item video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    object-position: center;
  }

  .product-badges {
    position: absolute;
    top: 1rem;
    left: 1rem;
    display: flex;
    gap: 0.5rem;
  }

  .badge {
    padding: 0.5rem 1rem;
    border-radius: 4px;
    font-size: 0.75rem;
    font-weight: 700;
    letter-spacing: 0.5px;
  }

  .badge-new {
    background: #f97316;
    color: white;
  }

  .badge-sold {
    background: #6b7280;
    color: white;
  }

  /* Product Info */
  .product-info {
    padding-top: 1rem;
  }

  .product-title {
    font-size: 2rem;
    font-weight: 600;
    color: #111827;
    margin: 0 0 0.5rem 0;
    line-height: 1.2;
  }

  .product-subtitle {
    font-size: 1rem;
    color: #6b7280;
    margin: 0 0 2rem 0;
  }

  /* Product Price */
  .product-price {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #e5e7eb;
  }

  .price-amount {
    font-size: 2.5rem;
    font-weight: 700;
    color: #111827;
    display: block;
    line-height: 1;
    margin-bottom: 0.5rem;
  }

  .price-note {
    font-size: 0.875rem;
    color: #6b7280;
    display: block;
  }

  /* No Image State */
  .no-image {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    width: 100%;
    height: 100%;
    color: #9ca3af;
  }

  .no-image svg {
    margin-bottom: 1rem;
  }

  .no-image p {
    margin: 0;
    font-size: 0.875rem;
  }

  /* Quick Links */
  .quick-links {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #e5e7eb;
  }

  .quick-link {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 0.75rem 1rem;
    background: #f9fafb;
    border-radius: 8px;
    color: #374151;
    text-decoration: none;
    font-size: 0.875rem;
    transition: all 0.2s ease;
    border: 1px solid transparent;
  }

  .quick-link:hover {
    background: white;
    border-color: #e5e7eb;
    color: #111827;
  }

  .quick-link svg {
    flex-shrink: 0;
  }

  /* Add to Cart */
  .add-to-cart-section {
    display: grid;
    grid-template-columns: 180px 1fr;
    gap: 1rem;
    margin-bottom: 2rem;
  }

  .quantity-selector {
    display: flex;
    align-items: center;
    border: 2px solid #e5e7eb;
    border-radius: 8px;
    overflow: hidden;
    background: white;
  }

  .quantity-btn {
    width: 48px;
    height: 56px;
    background: white;
    border: none;
    cursor: pointer;
    display: flex;
    align-items: center;
    justify-content: center;
    transition: background 0.2s ease;
    color: #374151;
  }

  .quantity-btn:hover {
    background: #f9fafb;
  }

  .quantity-btn:active {
    background: #f3f4f6;
  }

  #quantity {
    flex: 1;
    height: 56px;
    border: none;
    text-align: center;
    font-size: 1.125rem;
    font-weight: 600;
    background: white;
  }

  /* Ocultar flechas del input number */
  #quantity::-webkit-outer-spin-button,
  #quantity::-webkit-inner-spin-button {
    -webkit-appearance: none;
    margin: 0;
  }

  #quantity[type=number] {
    -moz-appearance: textfield;
  }

  .add-to-cart-btn {
    height: 60px;
    background: #111827;
    color: white;
    border: none;
    border-radius: 8px;
    font-size: 1rem;
    font-weight: 600;
    letter-spacing: 0.5px;
    cursor: pointer;
    transition: all 0.2s ease;
  }

  .add-to-cart-btn:hover:not(:disabled) {
    background: #1f2937;
    transform: translateY(-1px);
  }

  .add-to-cart-btn:disabled {
    background: #9ca3af;
    cursor: not-allowed;
  }

  /* Product Meta */
  .product-meta {
    display: flex;
    flex-direction: column;
    gap: 0.75rem;
    margin-bottom: 2rem;
  }

  .meta-item {
    display: flex;
    justify-content: space-between;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f3f4f6;
    font-size: 0.875rem;
  }

  .meta-label {
    color: #6b7280;
    font-weight: 500;
  }

  .meta-value {
    color: #111827;
    font-weight: 600;
  }

  .meta-value.in-stock {
    color: #10b981;
  }

  .meta-value.out-stock {
    color: #ef4444;
  }

  /* ===== NEW DETAILS SECTION - Two Column Layout ===== */
  .details-section {
    margin-bottom: 4rem;
    padding: 3rem 0;
    background: #f9fafb;
    margin-left: -1.5rem;
    margin-right: -1.5rem;
    padding-left: 1.5rem;
    padding-right: 1.5rem;
  }

  .details-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 4rem;
    max-width: 1400px;
    margin: 0 auto;
  }

  /* Left Column */
  .details-left {
    display: flex;
    flex-direction: column;
  }

  .details-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #111827;
    margin: 0 0 1.25rem 0;
  }

  .details-description {
    font-size: 1rem;
    line-height: 1.75;
    color: #4b5563;
    margin: 0 0 2rem 0;
  }

  .characteristics-section {
    margin-bottom: 2rem;
    padding-bottom: 2rem;
    border-bottom: 1px solid #e5e7eb;
  }

  .characteristics-title {
    font-size: 1rem;
    font-weight: 600;
    color: #111827;
    margin: 0 0 1.25rem 0;
  }

  .info-block {
    margin-bottom: 1rem;
  }

  .info-block-title {
    font-size: 0.875rem;
    font-weight: 700;
    color: #111827;
    margin: 0 0 0.5rem 0;
  }

  .info-block-text {
    font-size: 0.9375rem;
    line-height: 1.6;
    color: #4b5563;
    margin: 0;
  }

  /* Accordions */
  .accordions-container {
    display: flex;
    flex-direction: column;
  }

  .accordion {
    border-bottom: 1px solid #e5e7eb;
  }

  .accordion-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 1.25rem 0;
    cursor: pointer;
    font-size: 1rem;
    font-weight: 500;
    color: #111827;
    list-style: none;
    user-select: none;
  }

  .accordion-header::-webkit-details-marker {
    display: none;
  }

  .accordion-header span {
    font-weight: 500;
  }

  .accordion-icon {
    transition: transform 0.3s ease;
    flex-shrink: 0;
    color: #6b7280;
  }

  .accordion[open] .accordion-icon {
    transform: rotate(45deg);
  }

  .accordion-content {
    padding: 0 0 1.25rem 0;
    animation: slideDown 0.3s ease;
  }

  .accordion-content p {
    font-size: 0.9375rem;
    line-height: 1.6;
    color: #4b5563;
    margin: 0;
  }

  .accordion-item {
    display: flex;
    justify-content: space-between;
    padding: 0.5rem 0;
    font-size: 0.9375rem;
  }

  .accordion-item-label {
    color: #6b7280;
  }

  .accordion-item-value {
    color: #111827;
    font-weight: 500;
  }

  /* Characteristic items dentro del accordion */
  .characteristic-item {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    padding: 0.75rem 0;
    border-bottom: 1px solid #f3f4f6;
    font-size: 0.9375rem;
  }

  .characteristic-item:last-child {
    border-bottom: none;
  }

  .characteristic-label {
    color: #6b7280;
    flex-shrink: 0;
    margin-right: 1rem;
  }

  .characteristic-value {
    color: #111827;
    font-weight: 500;
    text-align: right;
  }

  /* Tech Sheet Note */
  .tech-sheet-note {
    display: flex;
    gap: 1rem;
    margin-top: 2rem;
    padding: 1.25rem;
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border-radius: 12px;
    border: 1px solid #bae6fd;
  }

  .tech-sheet-icon {
    flex-shrink: 0;
    width: 40px;
    height: 40px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border-radius: 10px;
    color: #0284c7;
    box-shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
  }

  .tech-sheet-content {
    flex: 1;
  }

  .tech-sheet-text {
    font-size: 0.9375rem;
    line-height: 1.5;
    color: #0c4a6e;
    margin: 0 0 0.75rem 0;
  }

  .tech-sheet-text strong {
    color: #0369a1;
  }

  .tech-sheet-link {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.875rem;
    font-weight: 600;
    color: #0284c7;
    text-decoration: none;
    transition: color 0.2s ease;
  }

  .tech-sheet-link:hover {
    color: #0369a1;
    text-decoration: underline;
  }

  /* No Measurements State */
  .no-measurements {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    padding: 1rem 1.25rem;
    background: #f9fafb;
    border-radius: 8px;
    border: 1px dashed #d1d5db;
  }

  .no-measurements-icon {
    color: #9ca3af;
    flex-shrink: 0;
  }

  .no-measurements-text {
    font-size: 0.875rem;
    line-height: 1.5;
    color: #6b7280;
    margin: 0;
  }

  @keyframes slideDown {
    from {
      opacity: 0;
      transform: translateY(-8px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Right Column - Measurements */
  .details-right {
    display: flex;
    flex-direction: column;
  }

  .measurements-title {
    font-size: 1.5rem;
    font-weight: 700;
    color: #111827;
    margin: 0 0 2rem 0;
  }

  .measurements-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
    margin-bottom: 2rem;
  }

  .measurement-card {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .measurement-card.full-width {
    grid-column: 1 / -1;
  }

  .measurement-label {
    font-size: 0.875rem;
    font-weight: 600;
    color: #111827;
    margin: 0;
  }

  .measurement-value {
    font-size: 0.9375rem;
    line-height: 1.5;
    color: #4b5563;
    margin: 0;
  }

  /* Measurements */
  .measurements-content {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 3rem;
  }

  .measurements-diagram img {
    width: 100%;
    border-radius: 8px;
  }

  .measurements-specs h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #111827;
    margin-bottom: 1.5rem;
  }

  .spec-grid {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
  }

  .spec-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
  }

  .spec-label {
    font-size: 0.875rem;
    font-weight: 600;
    color: #6b7280;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }

  .spec-value {
    font-size: 1rem;
    font-weight: 600;
    color: #111827;
    line-height: 1.6;
  }

  /* Examples Section */
  .examples-section,
  .downloads-section,
  .trust-section {
    margin-bottom: 4rem;
  }

  .examples-section h2,
  .downloads-section h2,
  .trust-section h2 {
    font-size: 2rem;
    font-weight: 600;
    color: #111827;
    margin-bottom: 0.5rem;
    text-align: center;
  }

  .section-subtitle {
    text-align: center;
    color: #6b7280;
    margin-bottom: 2.5rem;
    font-size: 1.125rem;
  }

  .examples-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }

  .example-item {
    border-radius: 12px;
    overflow: hidden;
    aspect-ratio: 4/3;
    background: #f9fafb;
  }

  .example-item.large {
    grid-column: span 2;
    grid-row: span 2;
  }

  .example-item img,
  .example-item video {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .example-item.video-item {
    position: relative;
    cursor: pointer;
  }

  .video-overlay {
    position: absolute;
    inset: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(0, 0, 0, 0.3);
    opacity: 1;
    transition: opacity 0.3s ease;
  }

  .example-item.video-item:hover .video-overlay {
    opacity: 0.8;
  }

  /* Downloads Section */
  .downloads-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 1.5rem;
  }

  .download-card {
    display: flex;
    align-items: center;
    gap: 1.25rem;
    padding: 1.5rem;
    background: white;
    border: 2px solid #e5e7eb;
    border-radius: 12px;
    text-decoration: none;
    transition: all 0.2s ease;
    cursor: pointer;
    font-family: inherit;
    text-align: left;
    width: 100%;
  }

  .download-card:hover {
    border-color: #111827;
    transform: translateY(-2px);
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
  }

  .download-card.downloading {
    pointer-events: none;
    position: relative;
    overflow: hidden;
  }

  .download-card.downloading::before {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(
      90deg,
      transparent 0%,
      rgba(255, 255, 255, 0.6) 50%,
      transparent 100%
    );
    animation: shimmer 1.5s infinite;
  }

  .download-card.downloading .download-info h3,
  .download-card.downloading .download-meta {
    opacity: 0;
  }

  .download-card.downloading .download-info::after {
    content: 'Descargando...';
    position: absolute;
    top: 50%;
    left: 0;
    transform: translateY(-50%);
    font-size: 0.9375rem;
    font-weight: 600;
    color: #111827;
    animation: blink 1s ease-in-out infinite;
  }

  .download-card.downloading .download-action svg {
    animation: bounce 0.6s ease-in-out infinite;
  }

  @keyframes shimmer {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
  }

  @keyframes blink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
  }

  @keyframes bounce {
    0%, 100% { transform: translateY(0); }
    50% { transform: translateY(3px); }
  }

  .download-icon {
    flex-shrink: 0;
    width: 56px;
    height: 56px;
    background: #f9fafb;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #111827;
  }

  .download-info {
    flex: 1;
    min-width: 0;
    overflow: hidden;
    position: relative;
  }

  .download-info h3 {
    font-size: 1rem;
    font-weight: 600;
    color: #111827;
    margin: 0 0 0.5rem 0;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }

  .download-meta {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-size: 0.8125rem;
    color: #6b7280;
  }

  .file-type {
    display: inline-flex;
    padding: 0.125rem 0.5rem;
    background: #f3f4f6;
    border-radius: 4px;
    font-weight: 600;
    font-size: 0.6875rem;
    letter-spacing: 0.025em;
    color: #374151;
  }

  .file-size {
    color: #9ca3af;
  }

  .download-action {
    color: #111827;
    flex-shrink: 0;
  }

  /* Trust Section */
  .trust-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    gap: 2rem;
  }

  .trust-card {
    text-align: center;
    padding: 2rem;
  }

  .trust-icon {
    width: 80px;
    height: 80px;
    margin: 0 auto 1.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    background: #f9fafb;
    border-radius: 50%;
    color: #111827;
  }

  .trust-card h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #111827;
    margin: 0 0 1rem 0;
  }

  .trust-card p {
    color: #6b7280;
    line-height: 1.6;
    margin: 0;
  }

  /* Trust Section Horizontal Layout */
  .trust-section {
    padding: 4rem 2rem;
    margin-left: -1.5rem;
    margin-right: -1.5rem;
    margin-bottom: 0;
  }

  .trust-header {
    text-align: left;
    margin-bottom: 3rem;
    max-width: 1400px;
    margin-left: auto;
    margin-right: auto;
  }

  .trust-header h2 {
    font-size: 2.5rem;
    font-weight: 600;
    color: #111827;
    text-align: left;
  }

  .trust-grid-horizontal {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 3rem;
    max-width: 1400px;
    margin: 0 auto;
  }

  .trust-card-horizontal {
    display: flex;
    gap: 2rem;
    align-items: flex-start;
  }

  .trust-icon-horizontal {
    flex-shrink: 0;
    width: 80px;
    height: 80px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: #111827;
  }

  .trust-content {
    flex: 1;
  }

  .trust-content h3 {
    font-size: 1.25rem;
    font-weight: 600;
    color: #111827;
    margin: 0 0 0.75rem 0;
  }

  .trust-content p {
    color: #4b5563;
    line-height: 1.6;
    margin: 0;
    font-size: 0.9375rem;
  }

  /* New Tabs Styles */
  .specs-table {
    display: flex;
    flex-direction: column;
    gap: 1rem;
    margin-top: 1.5rem;
  }

  .spec-row {
    display: grid;
    grid-template-columns: 200px 1fr;
    gap: 2rem;
    padding: 1rem;
    background: #f9fafb;
    border-radius: 8px;
  }

  .spec-name {
    font-weight: 600;
    color: #111827;
  }

  .spec-detail {
    color: #4b5563;
  }

  .finishes-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 2rem;
    margin-top: 2rem;
  }

  .finish-option {
    text-align: center;
  }

  .finish-swatch {
    width: 100%;
    height: 120px;
    border-radius: 12px;
    margin-bottom: 1rem;
    border: 2px solid #e5e7eb;
  }

  .finish-option h4 {
    font-size: 1rem;
    font-weight: 600;
    color: #111827;
    margin: 0 0 0.5rem 0;
  }

  .finish-option p {
    font-size: 0.875rem;
    color: #6b7280;
    margin: 0;
  }

  .assembly-steps {
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
    margin: 2rem 0;
  }

  .step {
    display: flex;
    gap: 1.5rem;
    padding: 1.5rem;
    background: #f9fafb;
    border-radius: 12px;
  }

  .step-number {
    width: 48px;
    height: 48px;
    background: #111827;
    color: white;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 1.25rem;
    font-weight: 700;
    flex-shrink: 0;
  }

  .step-content h4 {
    font-size: 1.125rem;
    font-weight: 600;
    color: #111827;
    margin: 0 0 0.5rem 0;
  }

  .step-content p {
    font-size: 0.9375rem;
    color: #4b5563;
    margin: 0;
  }

  .shipping-info {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
    gap: 2rem;
    margin: 2rem 0;
  }

  .info-card {
    text-align: center;
    padding: 2rem;
    background: #f9fafb;
    border-radius: 12px;
  }

  .info-card svg {
    color: #111827;
    margin-bottom: 1rem;
  }

  .info-card h4 {
    font-size: 1.125rem;
    font-weight: 600;
    color: #111827;
    margin: 0 0 0.5rem 0;
  }

  .info-card p {
    font-size: 0.9375rem;
    color: #6b7280;
    margin: 0;
  }

  /* ===== ANIMACIONES DE ENTRADA ===== */
  @keyframes fadeInUp {
    from {
      opacity: 0;
      transform: translateY(30px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  @keyframes fadeInLeft {
    from {
      opacity: 0;
      transform: translateX(-30px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes fadeInRight {
    from {
      opacity: 0;
      transform: translateX(30px);
    }
    to {
      opacity: 1;
      transform: translateX(0);
    }
  }

  @keyframes scaleIn {
    from {
      opacity: 0;
      transform: scale(0.95);
    }
    to {
      opacity: 1;
      transform: scale(1);
    }
  }

  @keyframes staggerFadeIn {
    from {
      opacity: 0;
      transform: translateY(15px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Breadcrumb animación */
  .breadcrumb-container {
    animation: fadeInUp 0.6s ease-out forwards;
  }

  /* Galería animación */
  .gallery-section {
    animation: fadeInLeft 0.7s ease-out 0.1s forwards;
    opacity: 0;
  }

  .gallery-thumbnails .thumbnail {
    opacity: 0;
    animation: staggerFadeIn 0.4s ease-out forwards;
  }

  .gallery-thumbnails .thumbnail:nth-child(1) { animation-delay: 0.3s; }
  .gallery-thumbnails .thumbnail:nth-child(2) { animation-delay: 0.4s; }
  .gallery-thumbnails .thumbnail:nth-child(3) { animation-delay: 0.5s; }
  .gallery-thumbnails .thumbnail:nth-child(4) { animation-delay: 0.6s; }
  .gallery-thumbnails .thumbnail:nth-child(5) { animation-delay: 0.7s; }

  /* Product Info animación */
  .product-info {
    animation: fadeInRight 0.7s ease-out 0.2s forwards;
    opacity: 0;
  }

  .product-title {
    animation: fadeInUp 0.5s ease-out 0.4s forwards;
    opacity: 0;
  }

  .product-subtitle {
    animation: fadeInUp 0.5s ease-out 0.5s forwards;
    opacity: 0;
  }

  .product-meta .meta-item {
    opacity: 0;
    animation: staggerFadeIn 0.4s ease-out forwards;
  }

  .product-meta .meta-item:nth-child(1) { animation-delay: 0.55s; }
  .product-meta .meta-item:nth-child(2) { animation-delay: 0.65s; }
  .product-meta .meta-item:nth-child(3) { animation-delay: 0.75s; }

  .add-to-cart-section {
    animation: fadeInUp 0.5s ease-out 0.8s forwards;
    opacity: 0;
  }

  .quick-links .quick-link {
    opacity: 0;
    animation: staggerFadeIn 0.4s ease-out forwards;
  }

  .quick-links .quick-link:nth-child(1) { animation-delay: 0.9s; }
  .quick-links .quick-link:nth-child(2) { animation-delay: 1s; }
  .quick-links .quick-link:nth-child(3) { animation-delay: 1.1s; }
  .quick-links .quick-link:nth-child(4) { animation-delay: 1.2s; }

  /* Secciones con animación al scroll (se activan con IntersectionObserver en JS) */
  .details-section,
  .examples-section,
  .downloads-section,
  .trust-section {
    opacity: 0;
    transform: translateY(40px);
    transition: opacity 0.7s ease-out, transform 0.7s ease-out;
  }

  .details-section.animate-in,
  .examples-section.animate-in,
  .downloads-section.animate-in,
  .trust-section.animate-in {
    opacity: 1;
    transform: translateY(0);
  }

  /* Animación de las tarjetas de descarga */
  .download-card {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
  }

  .downloads-section.animate-in .download-card:nth-child(1) { transition-delay: 0.1s; opacity: 1; transform: translateY(0); }
  .downloads-section.animate-in .download-card:nth-child(2) { transition-delay: 0.2s; opacity: 1; transform: translateY(0); }
  .downloads-section.animate-in .download-card:nth-child(3) { transition-delay: 0.3s; opacity: 1; transform: translateY(0); }

  /* Animación de las tarjetas de confianza */
  .trust-card-horizontal {
    opacity: 0;
    transform: translateY(20px);
    transition: opacity 0.5s ease-out, transform 0.5s ease-out;
  }

  .trust-section.animate-in .trust-card-horizontal:nth-child(1) { transition-delay: 0.1s; opacity: 1; transform: translateY(0); }
  .trust-section.animate-in .trust-card-horizontal:nth-child(2) { transition-delay: 0.2s; opacity: 1; transform: translateY(0); }
  .trust-section.animate-in .trust-card-horizontal:nth-child(3) { transition-delay: 0.3s; opacity: 1; transform: translateY(0); }
  .trust-section.animate-in .trust-card-horizontal:nth-child(4) { transition-delay: 0.4s; opacity: 1; transform: translateY(0); }

  /* Hover con transiciones suaves */
  .thumbnail,
  .quick-link,
  .download-card,
  .quantity-btn {
    transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
  }

  /* Animación del badge de novedad */
  .product-badges .badge {
    animation: scaleIn 0.4s ease-out 0.6s forwards;
    opacity: 0;
  }

  /* Preferencia de movimiento reducido */
  @media (prefers-reduced-motion: reduce) {
    *,
    *::before,
    *::after {
      animation-duration: 0.01ms !important;
      animation-iteration-count: 1 !important;
      transition-duration: 0.01ms !important;
    }
    
    .gallery-section,
    .product-info,
    .product-title,
    .product-subtitle,
    .product-meta .meta-item,
    .add-to-cart-section,
    .quick-links .quick-link,
    .gallery-thumbnails .thumbnail,
    .details-section,
    .examples-section,
    .downloads-section,
    .trust-section,
    .download-card,
    .trust-card-horizontal,
    .product-badges .badge {
      opacity: 1 !important;
      transform: none !important;
    }
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .product-main {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .gallery-section {
      grid-template-columns: 80px 1fr;
    }

    .details-grid {
      grid-template-columns: 1fr;
      gap: 3rem;
    }

    .details-right {
      order: -1;
    }

    .measurements-grid {
      grid-template-columns: repeat(3, 1fr);
    }

    .examples-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .example-item.large {
      grid-column: span 1;
      grid-row: span 1;
    }
  }

  @media (max-width: 768px) {
    .product-page {
      padding: 0 1rem;
    }

    .gallery-section {
      grid-template-columns: 1fr;
      grid-template-rows: auto 80px;
    }

    .gallery-main {
      grid-row: 1;
      height: 450px;
    }

    .gallery-thumbnails {
      grid-row: 2;
      flex-direction: row;
      overflow-x: auto;
    }

    .add-to-cart-section {
      grid-template-columns: 1fr;
    }

    .details-section {
      padding: 2rem 1rem;
      margin-left: -1rem;
      margin-right: -1rem;
    }

    .details-grid {
      gap: 2.5rem;
    }

    .details-title,
    .measurements-title {
      font-size: 1.25rem;
    }

    .measurements-grid {
      grid-template-columns: 1fr 1fr;
      gap: 1.5rem;
    }

    .examples-grid {
      grid-template-columns: 1fr;
    }

    .trust-grid {
      grid-template-columns: 1fr;
    }

    .trust-grid-horizontal {
      grid-template-columns: 1fr;
      gap: 2rem;
    }

    .trust-card-horizontal {
      flex-direction: column;
      align-items: center;
      text-align: center;
      gap: 1rem;
    }

    .trust-content {
      text-align: center;
    }

    .trust-header h2 {
      font-size: 1.75rem;
    }

    .trust-section {
      padding: 3rem 1rem;
    }

    .spec-row {
      grid-template-columns: 1fr;
      gap: 0.5rem;
    }

    .finishes-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .step {
      flex-direction: column;
      align-items: center;
      text-align: center;
    }

    .shipping-info {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 480px) {
    .product-title {
      font-size: 1.5rem;
    }

    .breadcrumb {
      font-size: 0.75rem;
    }

    .downloads-grid {
      grid-template-columns: 1fr;
    }
  }
</style>

<script>
  // 1. Envolvemos la lógica en una función para poder reutilizarla
  const initProductPage = () => {
    
    // --- TU CÓDIGO ORIGINAL EMPIEZA AQUÍ ---

    // Gallery functionality
    const thumbnails = document.querySelectorAll<HTMLButtonElement>(".thumbnail");
    const mediaItems = document.querySelectorAll<HTMLDivElement>(".media-item");

    if (thumbnails.length > 0 && mediaItems.length > 0) {
      thumbnails.forEach((thumb, index) => {
        thumb.addEventListener("click", () => {
          thumbnails.forEach((t) => t.classList.remove("active"));
          mediaItems.forEach((m) => m.classList.remove("active"));
          thumb.classList.add("active");
          if (mediaItems[index]) {
            mediaItems[index].classList.add("active");
          }
        });
      });
    }

    // Quantity selector
    const decreaseBtn = document.getElementById("decreaseQty") as HTMLButtonElement;
    const increaseBtn = document.getElementById("increaseQty") as HTMLButtonElement;
    const quantityInput = document.getElementById("quantity") as HTMLInputElement;

    if (decreaseBtn && quantityInput) {
      // Nota: Es buena práctica clonar y reemplazar o remover listeners previos si usas SPA,
      // pero con astro:page-load el DOM se refresca, así que esto suele ser seguro.
      decreaseBtn.addEventListener("click", () => {
        const currentValue = parseInt(quantityInput.value);
        if (currentValue > 1) {
          quantityInput.value = (currentValue - 1).toString();
        }
      });
    }

    if (increaseBtn && quantityInput) {
      increaseBtn.addEventListener("click", () => {
        const currentValue = parseInt(quantityInput.value);
        const maxValue = parseInt(quantityInput.max);
        if (currentValue < maxValue) {
          quantityInput.value = (currentValue + 1).toString();
        }
      });
    }

    // Validación para input manual
    if (quantityInput) {
      quantityInput.addEventListener("input", () => {
        let value = parseInt(quantityInput.value);
        const min = parseInt(quantityInput.min);
        const max = parseInt(quantityInput.max);

        if (isNaN(value)) return;

        if (value < min) {
          quantityInput.value = min.toString();
        } else if (value > max) {
          quantityInput.value = max.toString();
        }
      });

      quantityInput.addEventListener("blur", () => {
        let value = parseInt(quantityInput.value);
        const min = parseInt(quantityInput.min);
        if (isNaN(value) || value < min) {
          quantityInput.value = min.toString();
        }
      });
    }

    // Smooth scroll
    document.querySelectorAll<HTMLAnchorElement>(".quick-link").forEach((link) => {
      link.addEventListener("click", (e) => {
        e.preventDefault();
        const href = link.getAttribute("href");
        if (!href) return;
        
        const targetId = href.substring(1);
        const targetElement = document.getElementById(targetId);

        if (targetElement) {
          const offset = 80;
          const elementPosition = targetElement.getBoundingClientRect().top;
          const offsetPosition = elementPosition + window.pageYOffset - offset;

          window.scrollTo({
            top: offsetPosition,
            behavior: "smooth"
          });
        }
      });
    });

    // Lazy load videos
    if ('IntersectionObserver' in window) {
      const videoObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            const video = entry.target as HTMLVideoElement;
            if (video.dataset.src) {
              video.src = video.dataset.src;
              video.load();
              videoObserver.unobserve(video);
            }
          }
        });
      }, { rootMargin: '50px' });

      document.querySelectorAll<HTMLVideoElement>('video[data-src]').forEach(video => {
        videoObserver.observe(video);
      });
    }

    // Animaciones al scroll
    const animateSections = document.querySelectorAll<HTMLElement>(
      '.details-section, .examples-section, .downloads-section, .trust-section'
    );

    if ('IntersectionObserver' in window) {
      const sectionObserver = new IntersectionObserver((entries) => {
        entries.forEach(entry => {
          if (entry.isIntersecting) {
            entry.target.classList.add('animate-in');
            sectionObserver.unobserve(entry.target);
          }
        });
      }, { threshold: 0.15, rootMargin: '0px 0px -50px 0px' });

      animateSections.forEach(section => {
        sectionObserver.observe(section);
      });
    } else {
      animateSections.forEach(section => {
        section.classList.add('animate-in');
      });
    }

    // Download files - descarga sin abrir nueva pestaña
    document.querySelectorAll<HTMLButtonElement>('.download-card').forEach(btn => {
      btn.addEventListener('click', async () => {
        const url = btn.dataset.url;
        const filename = btn.dataset.filename || 'archivo';
        
        if (!url) return;

        try {
          // Mostrar estado de descarga
          btn.classList.add('downloading');
          
          // Fetch del archivo
          const response = await fetch(url);
          const blob = await response.blob();
          
          // Crear link temporal para descarga
          const downloadUrl = window.URL.createObjectURL(blob);
          const a = document.createElement('a');
          a.href = downloadUrl;
          a.download = filename;
          document.body.appendChild(a);
          a.click();
          
          // Limpiar
          window.URL.revokeObjectURL(downloadUrl);
          document.body.removeChild(a);
          
          btn.classList.remove('downloading');
        } catch (error) {
          console.error('Error al descargar:', error);
          btn.classList.remove('downloading');
          // Fallback: abrir en nueva pestaña si falla
          window.open(url, '_blank');
        }
      });
    });
    // --- FIN DE TU CÓDIGO ORIGINAL ---
  };

  // 2. Ejecutar en cada navegación (carga inicial + transiciones)
  document.addEventListener('astro:page-load', initProductPage);
</script>
